var domain_pubref=window.domain_pubref||"//pubref.paperol.cn",domain_pubnew=window.domain_pubnew||"//pubnew.paperol.cn",domain_pubali=window.domain_pubali||"https://pubali.oss-cn-hangzhou.aliyuncs.com";!function(m){var f,w,y=domain_pubali;m.uploadImg=function(e,o){var t=e.trigger,a=e.maxSize||4,r=e.maxNumber||1,l=e.maxWidth||700,u="",p=[],c=1,s={},d="";function h(i,t){var e=-1<window.location.href.indexOf("userinfo.aspx")?"/handler/getoss.ashx?username="+encodeURIComponent(username):"/handler/getoss.ashx?activity="+(window.activityID||window.activityId);s.policy?n(i,s,t):m.get(e,function(e){n(i,e,t)})}function n(e,t,n){s=t;pos=(n=n).lastIndexOf("."),suffix="";n=suffix=-1!=pos?n.substring(pos):suffix,u=t.dir+Date.parse(new Date)/1e3+function(e){e=e||32;var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,a="";for(i=0;i<e;i++)a+=t.charAt(Math.floor(Math.random()*n));return a}(10)+n,t.host,t={key:u,policy:t.policy,OSSAccessKeyId:t.accessid,success_action_status:"200",signature:t.signature,"content-type":"image/"+n.replace(".","")};e.setOption({url:y,multipart_params:t}),e.start()}var g=new plupload.Uploader({runtimes:"html5,silverlight,html4",browse_button:t,url:"https://oss.aliyuncs.com",silverlight_xap_url:"/js/plupload-2.2.1/Moxie.xap",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png,bmp,jpeg"}]},init:{FilesAdded:function(e,i){if(c=i.length,p=[],0==i.length)return alert("请选择图片文件，"+a+"M以内"),!1;if(i.length>r){alert("提示：1次只能选择"+r+"个文件！");for(var t=0;t<i.length;t++)g.removeFile(i[t]);return!1}if((size=i[0].size)>1024*parseInt(a)*1024)return alert("请选择"+a+"M以内的图片文件！"),g.removeFile(i[0]),!1;if(window.FileReader){var n=new FileReader;try{n.readAsDataURL(i[0].getNative())}catch(e){n.readAsDataURL(i[0].getSource().getSource())}n.onload=function(e){var i=new Image;i.src=e.target.result,i.onload=function(){f=this.width,imgheight=this.height}}}d=i[0].name,h(e,i[i.length-1].name)},BeforeUpload:function(e,i){window.layer&&(w=layer.load(3,{content:"图片上传中...",success:function(e){e.find(".layui-layer-content").css({"padding-top":"40px",width:"200px"})}})),h(e,i.name),0},FileUploaded:function(e,i,t){if(200==t.status&&1==r){var n=domain_pubnew+"/"+u,a=(f||((a=document.createElement("img")).onload=function(){f=this.width,imgheight=this.height,showImage()},a.src=n),m("#divsetbag")),a=(a&&0<a.length&&a.eq(0).hasClass("open")&&(a=a.find(".style-settings__type-pc"))&&0<a.length&&a.eq(0).hasClass("on")&&(l=1920),f&&0<f-l);if(n.indexOf(".gif")<0){var s=!1;try{s=401==window.parent.nowtype}catch(e){}!a&&size&&0<size-409600||s?n+="?x-oss-process=image/quality,q_85":a&&(n+="?x-oss-process=image/quality,q_90/resize,w_"+l)}o.call(null,n,d)}else 200==t.status&&1<r?(a=s=domain_pubnew+"/"+u,n=i.size,s=a+=n&&0<n-409600?"?x-oss-process=image/quality,q_85/resize,w_700":"?x-oss-process=image/resize,w_700",p.push(s),c==p.length&&o.call(null,p,d)):alert(t.response);window.layer&&layer.close(w)}}});g.init()}}(jQuery);