var newele,htCheckQs=new Object,htQuestion=new Object,curtype=window.qcurtype;function replaceName(e){return e?e.replace(/[\'\"\(\)\<\>]/g,""):""}function saveQuery(e,t){var n=getQueryCond(),a="",e=("100"==e?a="&share=1":e?a="&s="+e:window.isCeping&&(a="&s=5"),420),i=(window.isMobile&&(e=320),"");queryName&&(i="&name="+encodeURIComponent(replaceName(queryName))),t&&(a+="&isreport=1"),"1"==window.satParam&&(a+="&sat=1"),PDF_launch("/wjx/activitystat/savereport.aspx?activity="+activityId+i+"&type=1"+a+"&qCond="+n[0]+"&econd="+n[1],e,120)}function toCheck(e,t){if(!e.value||-4==e.value){var n=e.parentNode.ddlQuery,n=(n=t?e.parentNode.ddlListCompare:n)||e.parentNode.parentNode.getElementsByTagName("select")[0];if(-4==e.value){if(1==t){for(var a=0;a<dllCompareQueries.length;a++)if(n!=dllCompareQueries[a]&&dllCompareQueries[a].spanCondition.isAndOperate)return alert("只能有一个条件选择“同时包含多个选项的数据”"),void(e.value=1)}else for(a=0;a<ddlQueries.length;a++)if(n!=ddlQueries[a]&&ddlQueries[a].spanCondition.isAndOperate)return alert("只能有一个条件选择“同时包含多个选项的数据”"),void(e.value=1);n.spanCondition&&(n.spanCondition.isAndOperate=!0)}htCheckQs[n.value]="1",(1==t?showCompareCondition:showCondition).call(n)}}function showMulCond(e,t,n,a){if(htCheckQs[a]){var i="";i+="<span class='wjxui-input-block wjxui-form-checkbox wjx__templet__beautifyInput'>&nbsp;&nbsp;";for(var o=0;o<t.options.length-1;o++){var l=t.options[o],s="ccdcv"+n+"_"+(o+1);i+="<input type='checkbox' value='"+l.value+"' id='"+s+"'/><label for='"+s+"' style='margin-right:12px;'>"+l.text+"</label>"}i+="</span>",e.style.verticalAlign="top",e.style.lineHeight="22px",e.innerHTML=i}else e.appendChild(t).cloneNode(!0)}function setCityBox(e,t,n){txtCurCity.value=e,txtCurCity.relValue=n,PDF_close()}function checkChange(e){if(e.value&&e.parentNode.parentNode.ddlQuery&&e.parentNode.parentNode.ddlQuery.spanCondition&&e.parentNode.parentNode.ddlQuery.spanCondition.isAndOperate){var t=e.parentNode.getElementsByTagName("input");if(t&&!(t.length<=5))for(var n=0,a=0;a<t.length;a++)if(t[a].checked&&n++,5<n)return e.checked=!1,void alert("该查询操作最多选择不能超过五个选项")}}function showCompareCondition(){var e=this.value,t=this,n=this.spanCondition||document.createElement("span");if(n.innerHTML="",4==curtype&&(n.style.marginLeft="5px"),this.style.width="320px",window.isMobile&&(this.className="normal-select"),parseInt(e)==e&&0<e){var a=this.selectedIndex-1,i=qsCompareQuery[a],o=i.split("§"),l="";if(i){if(htCheckQs[e]){if(l+="<span class='wjxui-input-block wjxui-form-checkbox wjx__templet__beautifyInput'>&nbsp;&nbsp;",5e8<e&&e<6e8)for(d=0;d<o.length;d++)null!=(r=o[d].split("︴"))&&2==r.length&&(l+="<input type='checkbox' value='"+(c=r[1])+"' id='"+(s="cccompare"+e+"_"+c)+"'/><label for='"+s+"' style='margin-right:12px;'>"+r[0]+"</label>");else for(var s,d=0;d<o.length;d++)l+="<input type='checkbox' value='"+(c=d+1)+"' id='"+(s="cccompare"+e+"_"+c)+"' onchange='checkChange(this)' /><label for='"+s+"' style='margin-right:12px;'>"+o[d]+"</label>";l+="</span>",n.style.display="top",n.style.lineHeight="22px"}else{4==curtype&&(a=a+"_"+_$(this).closest(".condition-cont4").index());i=window.isMobile?160:288,l="<select id='sel"+a+"'  style='width:"+(i=288==i&&-1<window.location.href.indexOf("viewstatsummary")?300:i)+"px;' class='choicesel' onchange='toCheck(this, 1);'>";if(l+="<option value='0'>全部选项</option>",5e8<e&&e<6e8)for(var r,d=0;d<o.length;d++)null!=(r=o[d].split("︴"))&&2==r.length&&(l+="<option value='"+(c=r[1])+"'>"+r[0]+"</option>");else for(var c,d=0;d<o.length;d++)l+="<option value='"+(c=d+1)+"'>"+o[d]+"</option>";l=(l=l+"<optgroup label='---------------------'>"+"<option value=''>选择多个选项对比</option>")+"<optgroup>"+"</select>",n.style.verticalAlign="",n.style.lineHeight=""}n.innerHTML=4==curtype?l+"<span class='selectsearch'></span>":l}else{var a=(y=this.options[this.selectedIndex]).getAttribute("isdigit"),i="1"==y.getAttribute("isdate"),u=y.getAttribute("datetype")||"";htQuestion[e]="1",a||i?(n.appendChild(document.getElementById("spanEntry").cloneNode(!0)),(a=n.getElementsByTagName("select")[0]).onchange=function(){this.parentNode.getElementsByTagName("label")[0].style.display="3"==this.value?"":"none";var e=this.parentNode.getElementsByTagName("input");e[0].setAttribute("datetype",u),e[1]&&e[1].setAttribute("datetype",u),window.isMobile||("3"==this.value?e[0].style.width="80px":e[0].style.width="182px")},a.onchange(),htQuestion[e]="2"):n.appendChild(document.getElementById("spanQuestion").cloneNode(!0))}n.ddlQuery=t}this.parentNode.append(n);var p,h=(this.spanCondition=n).getElementsByTagName("input"),y=this.options[this.selectedIndex],i="提交答卷日期"==e||y&&"1"==y.getAttribute("isdate"),m=y&&y.getAttribute("ismul");h[0]&&"checkbox"!=h[0].type&&(h[0].value="",h[0].checkType=e,h[0].onkeydown=doEnterQuery,i?(h[0].onclick=function(e){var t=this.getAttribute("datetype")||"";calendar.show(this,null,window.event||e,"",0,t)},h[0].onchange=h[0].onblur=null):m?(h[0].onclick=function(e){txtCurCity=h[0];var t=parseInt(y.value)/1e4,n=y.value;"省市区"==m?PDF_launch("/joinnew/setcitycounty.aspx?activityid="+activityId+"&ct=3&pos="+t+"&nocheck=1",400,280):"多级下拉"==m||"门店选择"==m?PDF_launch("/joinnew/setmenuselp.aspx?activityid="+activityId+"&ct=5&pos="+t+"&nocheck=1&fqid="+n,470,280):"国家及地区"==m?PDF_launch("/joinnew/setcountry.aspx?activityid="+activityId+"&ct=8&pos="+t+"&nocheck=1",400,240):"城市单选"==m&&PDF_launch("/joinnew/setcitymobo2.aspx?activityid="+activityId+"&ct=1&pos="+t+"&nocheck=1",400,240)},h[0].onchange=h[0].onblur=null):(h[0].onchange=h[0].onblur=checkData,h[0].onclick=null),h[1])&&"checkbox"!=h[1].type&&(h[1].checkType=e,h[1].value="",h[1].onkeydown=doEnterQuery,i?(h[1].onclick=function(e){var t=this.getAttribute("datetype")||"";calendar.show(this,null,window.event||e,"",0,t)},h[1].onchange=h[0].onblur=null):(h[1].onchange=h[0].onblur=checkData,h[1].onclick=null)),window.isQywx&&"企业微信部门"!=e&&"企业微信姓名"!=e&&($(t).parent().parent().find(".qywx-chooselist-bm").html(""),$(t).parent().parent().find(".qywx-chooselist-ry").html("")),4==curtype&&(p=this,"10000"==_$(p).val())&&_$(p).parent().next().find("select").selectpick({container:_$(p).closest(".condition-cont4").find(".selectsearch"),width:300,height:32,disabled:!1,MaxfreeWidth:300,search:!0,searchText:"搜索",open:function(){_$(p).closest(".condition-cont4").find(".selectsearch").find(".optHead").remove()}}),newele&&(window.isQywxClient?newele.onclick=wxcheckpeo:newele.onclick=selPersonPart)}function showCondition(){var e,t=this.value,n=this,a=this.spanCondition||document.createElement("span");if(a.innerHTML="",4==curtype&&(a.style.marginLeft="5px"),this.style.width="320px",window.isMobile&&(this.className="normal-select"),parseInt(t)==t){var i=this.selectedIndex,o=qsQuery[i],l=o.split("§"),s="1"==this.options[this.selectedIndex].getAttribute("check"),d="";if(o){if(htCheckQs[t]){if(d+="<span class='wjxui-input-block wjxui-form-checkbox wjx__templet__beautifyInput'>&nbsp;&nbsp;",5e8<t&&t<6e8)for(c=0;c<l.length;c++)null!=(u=l[c].split("︴"))&&2==u.length&&(d+="<input type='checkbox' value='"+(p=u[1])+"' id='"+(r="ccc"+t+"_"+p)+"'/><label for='"+r+"' style='margin-right:12px;'>"+u[0]+"</label>");else for(var r,c=0;c<l.length;c++)d+="<input type='checkbox' value='"+(p=c+1)+"' id='"+(r="ccc"+t+"_"+p)+"' onchange='checkChange(this)' /><label for='"+r+"' style='margin-right:12px;'>"+l[c]+"</label>";d+="</span>",a.style.display="top",a.style.lineHeight="22px"}else{4==curtype&&(i=i+"_"+_$(this).closest(".condition-cont4").index());o=window.isMobile?160:288,d="<select id='sel"+i+"'  style='width:"+(o=288==o&&-1<window.location.href.indexOf("viewstatsummary")?300:o)+"px;' class='choicesel' onchange='toCheck(this);'>";if(5e8<t&&t<6e8)for(var u,c=0;c<l.length;c++)null!=(u=l[c].split("︴"))&&2==u.length&&(d+="<option value='"+(p=u[1])+"'>"+u[0]+"</option>");else for(var p,c=0;c<l.length;c++)d+="<option value='"+(p=c+1)+"'>"+l[c]+"</option>";d=(d=d+"<option value='-3'>(跳过)</option>"+"<option value='-2'>(空)</option>")+"<optgroup label='---------------------'>"+"<option value=''>合并多个选项的数据</option>",s&&(d+="<option value='-4'>同时包含多个选项的数据</option>"),d=d+"<optgroup>"+"</select>",a.style.verticalAlign="",a.style.lineHeight=""}a.innerHTML=4==curtype?d+"<span class='selectsearch'></span>":d}else{var h,i=(g=this.options[this.selectedIndex]).getAttribute("isdigit"),o="1"==g.getAttribute("isdate"),y=g.getAttribute("datetype")||"";htQuestion[t]="1",i||o?(a.appendChild(document.getElementById("spanEntry").cloneNode(!0)),(h=a.getElementsByTagName("select")[0]).onchange=function(){this.parentNode.getElementsByTagName("label")[0].style.display="3"==this.value?"":"none";var e=this.parentNode.getElementsByTagName("input");e[0].setAttribute("datetype",y),e[1]&&e[1].setAttribute("datetype",y),window.isMobile||("3"==this.value?e[0].style.width="80px":e[0].style.width="182px")},h.onchange(),htQuestion[t]="2"):a.appendChild(document.getElementById("spanQuestion").cloneNode(!0))}a.ddlQuery=n}else switch(t){case"省份":ddlProvince.dataLoaded?showMulCond(a,ddlProvince,1,t):loadJoinData(a,ddlProvince,1);break;case"来源":ddlSource.dataLoaded?showMulCond(a,ddlSource,3,t):loadJoinData(a,ddlSource,3);break;case"城市":ddlCity.dataLoaded?a.appendChild(ddlCity).cloneNode(!0):loadJoinData(a,ddlCity,2);break;case"常用备注":if(ddlCommonNote.dataLoaded){if(ddlCommonNote.noData){alert("提示：没有添加常用备注，无法根据此条件查询！");break}a.appendChild(ddlCommonNote).cloneNode(!0)}else loadJoinData(a,ddlCommonNote,4);break;case"星标":case"支付状态":a.appendChild(ddlStar).cloneNode(!0);break;case"IP地址":case"核销码":case"完成凭证":case"用户ID":case"来源详情":"IP地址"==t||"用户ID"==t?((e=document.getElementById("spanInclude").cloneNode(!0)).innerHTML="等于",a.appendChild(e)):"来源详情"==t&&((e=document.getElementById("spanInclude").cloneNode(!0)).innerHTML="包含",a.appendChild(e)),a.appendChild(document.getElementById("spanEntry").cloneNode(!0)),a.getElementsByTagName("select")[0].style.display="none",a.getElementsByTagName("label")[0].style.display="none";break;case"提交答卷日期":case"填写所用时间":case"填写序号":case"分数":a.appendChild(document.getElementById("spanEntry").cloneNode(!0)),(h=a.getElementsByTagName("select")[0]).onchange=function(){this.parentNode.getElementsByTagName("label")[0].style.display="3"==this.value?"":"none";var e=a.getElementsByTagName("input");"3"==this.value?e[0].style.width="80px":e[0].style.width="182px"},h.onchange();break;case"企业微信姓名":case"企业微信部门":n.style.width="478px",newele=document.createElement("span"),"企业微信部门"!=t?($(n).parent().parent().find(".qywx-chooselist-bm").eq(0).hide(),$(n).parent().parent().find(".qywx-chooselist-ry").eq(0).show(),newele.className="checkry",newele.setAttribute("peo",2),newele.setAttribute("type","user"),newele.innerHTML="选择人员"):($(n).parent().parent().find(".qywx-chooselist-bm").eq(0).show(),$(n).parent().parent().find(".qywx-chooselist-ry").eq(0).hide(),newele.className="checkbm",newele.innerHTML="选择部门",newele.setAttribute("type","department"),newele.setAttribute("peo",1)),a.appendChild(newele)}this.parentNode.parentNode.insertBefore(a,this.btnDelteQuery.parentNode);var m,v=(this.spanCondition=a).getElementsByTagName("input"),g=this.options[this.selectedIndex],s="提交答卷日期"==t||g&&"1"==g.getAttribute("isdate"),w=g&&g.getAttribute("ismul");v[0]&&"checkbox"!=v[0].type&&(v[0].value="",v[0].checkType=t,v[0].onkeydown=doEnterQuery,s?(v[0].onclick=function(e){var t=this.getAttribute("datetype")||"";calendar.show(this,null,window.event||e,"",0,t)},v[0].onchange=v[0].onblur=null):w?(v[0].onclick=function(e){txtCurCity=v[0];var t=parseInt(g.value)/1e4,n=g.value;"省市区"==w?PDF_launch("/joinnew/setcitycounty.aspx?activityid="+activityId+"&ct=3&pos="+t+"&nocheck=1",400,280):"多级下拉"==w||"门店选择"==w?PDF_launch("/joinnew/setmenuselp.aspx?activityid="+activityId+"&ct=5&pos="+t+"&nocheck=1&fqid="+n,470,280):"国家及地区"==w?PDF_launch("/joinnew/setcountry.aspx?activityid="+activityId+"&ct=8&pos="+t+"&nocheck=1",400,240):"城市单选"==w&&PDF_launch("/joinnew/setcitymobo2.aspx?activityid="+activityId+"&ct=1&pos="+t+"&nocheck=1",400,240)},v[0].onchange=v[0].onblur=null):(v[0].onchange=v[0].onblur=checkData,v[0].onclick=null),v[1])&&"checkbox"!=v[1].type&&(v[1].checkType=t,v[1].value="",v[1].onkeydown=doEnterQuery,s?(v[1].onclick=function(e){var t=this.getAttribute("datetype")||"";calendar.show(this,null,window.event||e,"",0,t)},v[1].onchange=v[0].onblur=null):(v[1].onchange=v[0].onblur=checkData,v[1].onclick=null)),window.isQywx&&"企业微信部门"!=t&&"企业微信姓名"!=t&&($(n).parent().parent().find(".qywx-chooselist-bm").html(""),$(n).parent().parent().find(".qywx-chooselist-ry").html("")),4==curtype&&(m=this,"10000"==_$(m).val())&&_$(m).parent().next().find("select").selectpick({container:_$(m).closest(".condition-cont4").find(".selectsearch"),width:300,height:32,disabled:!1,MaxfreeWidth:300,search:!0,searchText:"搜索",open:function(){_$(m).closest(".condition-cont4").find(".selectsearch").find(".optHead").remove()}}),newele&&(window.isQywxClient?newele.onclick=wxcheckpeo:newele.onclick=selPersonPart)}function loadJoinData(e,t,n){var a=loadData(n);if(a){var i=a.split("§");if(!t.dataLoaded){for(var o=0;o<i.length;o++){var l,s=i[o],d=i[o];3!=n&&4!=n||(s=(l=i[o].split("["))[0],2==l.length&&(d=l[1].replace("]",""))),t.options.add(new Option(d,s))}1!=n&&3!=n||((a=document.createElement("OPTGROUP")).label="---------------------",t.appendChild(a),t.options.add(new Option("合并多个选项的数据","")),t.onchange=function(){toCheck(this)}),t.dataLoaded=!0}e.appendChild(t).cloneNode(!0)}else alert("提示：没有添加常用备注，无法根据此条件查询！"),t.dataLoaded=!0,t.noData=!0}function doEnterQuery(e){if(13==(e=window.event||e).keyCode)return btnQueryClick(),e.returnValue=!1}function BindQsChoiceData(e,t){if(t){var n=t.split("╀"),a=!1;if(!n||n.length<=1?n=t.split("┋"):a=!0,1<n.length){htCheckQs[e.value]="1",e.onchange();for(var i=new Object,o=0;o<n.length;o++)i[n[o]]="1";a&&(e.spanCondition.isAndOperate=!0);for(var l=e.spanCondition.getElementsByTagName("input"),s=0;s<l.length;s++){var d=l[s];i[d.value]&&(d.checked=!0)}}else e.onchange(),e.spanCondition.getElementsByTagName("select")[0].value=t}else"undefined"!=typeof ddlListCompare&&e==ddlListCompare?(e.onchange(),e.spanCondition.getElementsByTagName("select")[0].value="0"):e==ddlQuery&&e.onchange()}function BindQsQuestionData(e,t){e.onchange();var n=e.spanCondition.getElementsByTagName("input"),n=(n[0].value=t[1]||"",n[1]&&t[3]&&(n[1].value=t[3]),t[2]||(t[2]="0"),e.spanCondition.getElementsByTagName("select")[0]);n.value=t[2].split(";")[0],n.onchange&&n.onchange()}function isQuestion(e){return 2<=e.split("§").length}function initQuery(e){ddlQuery.onchange=showCondition,"undefined"!=typeof ddlListCompare&&(ddlListCompare.onchange=showCompareCondition),ddlQuery.btnAddQuery=btnAddQuery,ddlQuery.btnDelteQuery=btnDelQ,btnAddQuery.onclick=addQuery,btnDelQ.onclick=function(){delQuery(ddlQuery.parentNode.parentNode,ddlQuery)},ddlQueries.push(ddlQuery),"undefined"!=typeof ddlListCompare&&dllCompareQueries.push(ddlListCompare),"4"==curtype&&_$(".condition-cont").addClass("condition-cont4");var t=reportType;if(4==(t=e&&1==e?e:t)&&qCond){var n=qCond.split(",");ddlListCompare.value=n[0],BindQsChoiceData(ddlListCompare,n[1])}else if(1==t&&(qCond||eCond)){var a=!0;if(qCond){var i=qCond.split("〒");isQuestion(i[0])?(n=i[0].split("§"),ddlQuery.value=n[0],BindQsQuestionData(ddlQuery,n)):(n=i[0].split(","),ddlQuery.value=n[0],BindQsChoiceData(ddlQuery,n[1]));for(var a=!1,o=1;o<i.length;o++)isQuestion(i[o])?addQuery((n=i[o].split("§"))[0],n):addQuery((n=i[o].split(","))[0],n[1])}if(eCond){var l=eCond.split("〒"),e=0;qCond||(bindECond(l[0],a),a=!1,e=1);for(o=e;o<l.length;o++)bindECond(l[o],a)}}else{for(o=0;o<ddlQuery.options.length;o++){var s=ddlQuery.options[o].text;if(isSample(s)||"企业微信部门"!=s){ddlQuery.selectedIndex=o;break}}ddlQuery.onchange()}}function bindECond(e,t){var n,a=e.split("┋"),i="",o=a[1],l=a[2],s=a[3];switch(a[0]){case"1":i="提交答卷日期";break;case"3":i="填写所用时间";break;case"4":i="填写序号";break;case"5":i="分数";break;case"7":i="省份",o=l,s=l="";break;case"8":i="来源",o=l,s=l="";break;case"9":i="城市",o=l,s=l="";break;case"10":i="IP地址";break;case"12":i="用户ID";break;case"11":i="核销码";break;case"13":i="来源详情";break;case"14":i="完成凭证";break;case"21":i="星标",1==window.isshop&&(i="支付状态"),o=l,s=l="";break;case"16":if(i="企业微信姓名",2<a.length&&""!=a[2]&&(a.splice(0,2),userIds=a[0].split(","),toUserArr=userIds),o=l,s=l="",!t)return addQuery(i,o,l,s),void makeWxOrigin(i);makeWxOrigin(i);break;case"17":if(i="企业微信部门",o=l,s=l="",0<(partmentList=a[2]?partmentList=a[2].split(","):[]).length)for(var d=0;d<partmentList.length;d++)partmentList[d]=parseInt(partmentList[d]);if(toDeptarr=partmentList,!t)return addQuery(i,o,l,s),void makeWxOrigin(i);makeWxOrigin(i);break;case"31":i="常用备注",o=l,s=l=""}t?(ddlQuery.value=i,ddlQuery.onchange(),e=ddlQuery.spanCondition.getElementsByTagName("input"),l&&(e[0]?e[0].value=l:null!=(n=ddlQuery.spanCondition.getElementsByTagName("select"))&&0<n.length&&(ddlQuery.spanCondition.getElementsByTagName("select")[0].value=l)),s&&(e[1].value=s,e[1].parentNode.style.display=""),o&&showMulData(o,ddlQuery)):addQuery(i,o,l,s)}function makeWxOrigin(e){var t=ddlQueries.length-1;if("企业微信部门"==e){if(0<partmentList.length){for(var n="",a=0;a<partmentList.length;a++)n+='<span class="qywxCspan"><ww-open-data type="departmentName" openid="'+partmentList[a]+'"></ww-open-data><i class="delDept"></i></span>';$(".qywx-chooselist-bm").eq(t).html(n),toDept=partmentList.join("|"),$(".delDept").click(function(e){var t=$(this).parent(".qywxCspan").index();partmentList.splice(t,1),toDeptarr=partmentList,toDept=partmentList.join("|"),$(this).parent(".qywxCspan").remove()})}else $(".qywx-chooselist-bm").eq(t).html("");$(".qywx-chooselist-bm").eq(t).show()}if("企业微信姓名"==e){if(0==userIds.length)$(".qywx-chooselist-ry").eq(t).html("");else if(0<userIds.length&&userIds[0]){for(n="",a=0;a<userIds.length;a++)n+='<span class=\'qywxCspan\'><ww-open-data type="userName" openid="'+userIds[a]+"\"></ww-open-data><i class='delPeo'></i></span>";$(".qywx-chooselist-ry").eq(t).html(n),toUser=userIds.join("|"),$(".delPeo").click(function(e){var t=$(this).parent(".qywxCspan").index();userIds.splice(t,1),toUserArr=userIds,toUser=userIds.join("|"),$(this).parent(".qywxCspan").remove()})}$(".qywx-chooselist-ry").eq(t).show()}}function delQuery(e,t){1==ddlQueries.length?divQueryMsg.innerHTML="必须要保留一个查询条件":(ddlQuery.parentNode.parentNode.parentNode.removeChild(e),ddlQueries.remove(t),t==ddlQuery&&(ddlQuery=ddlQueries[0]))}function addQuery(e,t,n,a){var i,o,l,s,d;ddlQueries.length>=queryCount?(divQueryMsg.innerHTML="最多只允许"+queryCount+"个查询条件",2==queryCount&&(window.isVip?divQueryMsg.innerHTML+="，<a href='/newwjx/manage/purchase.aspx' target='_blank'>购买企业版服务</a>允许4个查询条件":divQueryMsg.innerHTML+="，<a href='/register/upgradevip.aspx?upgradeReason=62' target='_blank'>升级并购买企业版</a>允许4个查询条件")):(divQueryMsg.innerHTML="",(i=document.createElement("div")).className="condition-cont",4==curtype&&(i.className="condition-cont condition-cont4"),(o=ddlQuery.cloneNode(!0)).onchange=showCondition,s=document.createElement("span"),i.appendChild(s),l=ddlQueries.length,d=0,(l=ddlQueries[l-1].selectedIndex)+1<ddlQuery.options.length?d=l+1:0<l-1&&(d=l-1),o.selectedIndex=d,e&&(o.value=e),s.appendChild(o),s.appendChild(document.createTextNode(" ")),l=document.createElement("span"),i.appendChild(l),(d=btnAddQuery.cloneNode(!0)).onclick=addQuery,o.btnAddQuery=d,o.spanCondition=null,(s=btnDelQ.cloneNode(!0)).onclick=function(){delQuery(i,o)},l.appendChild(s),o.btnDelteQuery=s,(d=document.createElement("div")).className="qywx-chooselist-bm",(l=document.createElement("div")).className="qywx-chooselist-ry",i.appendChild(d),i.appendChild(l),(s=document.createElement("div")).style.clear="both",i.appendChild(s),ddlQuery.parentNode.parentNode.parentNode.appendChild(i),ddlQueries.push(o),parseInt(e)==e?(t instanceof Array?BindQsQuestionData:BindQsChoiceData)(o,t):(o.onchange(),(d=o.spanCondition.getElementsByTagName("input"))[0]&&(d[0].value=n||""),d[1]&&(d[1].value=a||"",a)&&(d[1].parentNode.style.display=""),t&&showMulData(t,o)))}function showMulData(e,t){var n=e.split(",");if(1<n.length){htCheckQs[t.value]="1",t.onchange();for(var a=new Object,i=0;i<n.length;i++)a[n[i]]="1";for(var o=t.spanCondition.getElementsByTagName("input"),l=0;l<o.length;l++){var s=o[l];a[s.value]&&(s.checked=!0)}}else{t=t.spanCondition.getElementsByTagName("select")[0];t&&(t.value=e),t&&t.onchange&&t.onchange()}}function isInt(e){return parseInt(e)==e}function isDate(e){var t,n=e.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);return null!=n&&(t=new Date(n[1],n[3]-1,n[4])).getFullYear()+n[2]+(t.getMonth()+1)+n[2]+t.getDate()==e}function checkData(){switch(this.checkType){case"省份":case"来源":case"城市":break;case"星标":case"支付状态":break;case"IP地址":case"核销码":case"完成凭证":case"用户ID":case"来源详情":break;case"提交答卷日期":isDate(this.value)||(this.value="",divQueryMsg.innerHTML="必须为日期(如2010-1-1)");break;case"填写序号":break;case"填写所用时间":case"分数":isInt(this.value)||(this.value="",divQueryMsg.innerHTML="必须为整数")}}ddlSaveQuery&&(ddlSaveQuery.onchange=function(){this.value&&(window.location=this.value),btnDelQuery.style.display=this.value?"":"none",btnShareReport.style.display=this.value?"":"none"}),btnDelQuery&&(btnDelQuery.style.display=reportid&&0<+reportid?"":"none",btnDelQuery.onclick=function(){var e;"undefined"!=typeof queryType&&5==queryType?window.location.href="/wjx/activitystat/downloadattachmentlist.aspx?activity="+activityId:(e="/wjx/report/deletereport.aspx?activity="+activityId+"&reportid="+reportid+"&returnurl="+encodeURIComponent(window.location.href),lconfirm("如果数据源已被分享，删除后分享链接将无法查看且无法恢复，确认删除吗？",function(){PDF_launch(e,400,100)}))}),btnShareReport&&(btnShareReport.style.display=ddlSaveQuery.value?"":"none",btnShareReport.onclick=function(){isVip?PDF_launch("/wjx/ActivityStat/shareviewsummary.aspx?activity="+activityId+"&reportid"+reportid,720,520):alert("很抱歉，此功能只对企业版用户开放")});var queryName="";function getQueryCond(){for(var e="",t="",n=(queryName="",0),a=0,i=new Object,o=0;o<ddlQueries.length;o++){var l=ddlQueries[o].value;if(!i[l])if(i[l]="1",parseInt(l)==l){0<n&&(e+="〒");var s="";if(htQuestion[l]){var d=ddlQueries[o].spanCondition.getElementsByTagName("input"),r=d[0],c=ddlQueries[o].spanCondition.getElementsByTagName("select")[0],u="";r.value&&(u=l+"§"+r.value+"§"+c.value),"2"==htQuestion[l]&&(u+=";1"),"2"==htQuestion[l]&&"3"==c.value&&(d[1].value?u+="§"+d[1].value:u=""),e+=u}else{if(htCheckQs[l])for(var p,h=ddlQueries[o].spanCondition.getElementsByTagName("input"),y=0,m=0;m<h.length;m++)(f=h[m]).checked&&(p="┋",ddlQueries[o].spanCondition.isAndOperate&&(p="╀"),0<y&&(s+=p),s+=f.value,y++);else{s=(g=ddlQueries[o].spanCondition.getElementsByTagName("select")[0]).value;queryName+=g.options[g.selectedIndex].text}e+=l+","+s}n++}else{0<a&&(t+="〒");var v,g,w="";if(htCheckQs[l])for(var f,h=ddlQueries[o].spanCondition.getElementsByTagName("input"),y=0,m=0;m<h.length;m++)(f=h[m]).checked&&(0<y&&(w+=","),w+=f.value,y++);else(g=ddlQueries[o].spanCondition.getElementsByTagName("select")[0])&&(v=g.selectedIndex,w=g.value);var r=ddlQueries[o].spanCondition.getElementsByTagName("input"),b=r[0],C=r[1];switch(l){case"省份":t+="7┋0┋"+w,queryName+=w;break;case"常用备注":g&&(t+="31┋0┋"+w,queryName+=w);break;case"来源":t+="8┋0┋"+w,queryName+=w;break;case"城市":t+="9┋0┋"+w,queryName+=w;break;case"IP地址":t+="10┋0┋"+b.value;break;case"核销码":t+="11┋0┋"+b.value;break;case"完成凭证":t+="14┋0┋"+b.value;break;case"用户ID":t+="12┋0┋"+b.value;break;case"星标":case"支付状态":t+="21┋0┋"+ddlStar.value;break;case"来源详情":t+="13┋0┋"+b.value;break;case"提交答卷日期":t+="1┋"+v+"┋"+b.value+"┋"+C.value;break;case"填写所用时间":t+="3┋"+v+"┋"+b.value+"┋"+C.value;break;case"填写序号":t+="4┋"+v+"┋"+b.value+"┋"+C.value;break;case"分数":t+="5┋"+v+"┋"+b.value+"┋"+C.value;break;case"企业微信姓名":t+="16┋0┋"+toUser.split("|").join(",");break;case"企业微信部门":t+="17┋0┋"+toDept.split("|").join(",")}a++}}return[e=encodeURIComponent(e),t=encodeURIComponent(t)]}function getCompareQueryCond(){for(var e="",t=(queryName="",0),n=new Object,a=0;a<dllCompareQueries.length;a++){var i=dllCompareQueries[a].value;if(!n[i]&&(n[i]="1",parseInt(i)==i)){0<t&&(e+="〒");var o="";if(htQuestion[i]){var l=dllCompareQueries[a].spanCondition.getElementsByTagName("input"),s=l[0],d=dllCompareQueries[a].spanCondition.getElementsByTagName("select")[0],r="";s.value&&(r=i+"§"+s.value+"§"+d.value),"2"==htQuestion[i]&&(r+=";1"),"2"==htQuestion[i]&&"3"==d.value&&(l[1].value?r+="§"+l[1].value:r=""),e+=r}else{if(htCheckQs[i])for(var c=dllCompareQueries[a].spanCondition.getElementsByTagName("input"),u=0,p=0;p<c.length;p++){var h,y=c[p];y.checked&&0<y.value&&(h="┋",dllCompareQueries[a].spanCondition.isAndOperate&&(h="╀"),0<u&&(o+=h),o+=y.value,u++)}else{s=dllCompareQueries[a].spanCondition.getElementsByTagName("select")[0];0<s.value&&(o=s.value),queryName+=s.options[s.selectedIndex].text}e+=i+","+o}t++}}return e}document.onclick=function(e){window.calendar&&calendar.hide()},initQuery(),setTimeout(function(){window.needHideCond&&window.joinedTime&&joinedTime<2e5&&(btnAddQuery.style.display="")},1e3);