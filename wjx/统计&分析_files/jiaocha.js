var diffArray,topicX=new Array,topicY=new Array,ddlListX=document.getElementById("ddlListX"),ddlListY=document.getElementById("ddlListY"),divMsg=document.getElementById("divMsg"),btnAddX=document.getElementById("btnAddX"),btnAddY=document.getElementById("btnAddY"),regconds=new Array,btnDelJiaoCha=(2==reportType&&qCond&&(regconds=qCond.split(";")),btnAddX.onclick=function(){AddCondition(1)},btnAddY.onclick=function(){AddCondition(2)},1==needHideCond?btnAddQuery.style.display=btnAdd.style.display=btnAddX.style.display=btnAddY.style.display="none":2==needHideCond&&(btnAddY.style.display="none"),document.getElementById("btnDelJiaoCha")),btnDelCompare=document.getElementById("btnDelCompare");function saveJiaoCha(){var e,t;1==topicX.length&&"0"==topicX[0].value?divMsg.innerHTML="请选择自变量":1==topicY.length&&"0"==topicY[0].value?divMsg.innerHTML="请选择因变量":0<topicX.length&&0<topicY.length&&(t=getRCond(),e=topicX[0].options[topicX[0].selectedIndex].text.replace("(","").replace(")",""),t="/wjx/activitystat/savereport.aspx?activity="+activityId+"&type=2&qCond="+t+"&name="+encodeURIComponent(e),"1"==satParam&&(t+="&sat=1"),PDF_launch(t,404,207))}function ddlListChanged(){var e=this.value;divMsg.innerHTML="";for(var t,i=0;i<topicX.length;i++)if(this!=topicX[i]){if(e==topicX[i].value)return this.value="0",void(divMsg.innerHTML="题目不能重复");if((e<0||topicX[i].value<0)&&-1<topicX.indexOf(this))return t="",topicX[i].value<0?(t=topicX[i].options[topicX[i].selectedIndex].text,topicX[i].value="0"):(t=this.options[this.selectedIndex].text,this.value="0"),void(divMsg.innerHTML="很抱歉，"+t+"只能单独作为自变量，不能跟其它自变量组合。")}for(i=0;i<topicY.length;i++)if(this!=topicY[i]&&e==topicY[i].value)return this.value="0",void(divMsg.innerHTML="题目不能重复");this.prevValue=this.value}function Init(){switch(topicX.push(ddlListX),topicY.push(ddlListY),ddlListX.onchange=ddlListChanged,ddlListY.onchange=ddlListChanged,reportType){case 4:_$("#ddlListCompare").val(qCond);break;case-1:break;default:if(regconds[0]&&regconds[1]){var e=regconds[0].split(",");ddlListX.value=e[0];for(var t=1;t<e.length;t++)(i=e[t])&&"-1"!=i&&AddTopic(i,1);e=regconds[1].split(",");ddlListY.value=e[0];for(var i,t=1;t<e.length;t++)(i=e[t])&&"-1"!=i&&AddTopic(i,2)}else for(t=1;t<ddlListX.options.length;t++){var n=ddlListX.options[t].text;if(isSample(n)){ddlListX.selectedIndex=t;break}}1==topicX.length&&1==topicY.length&&(document.getElementById("hrefSwapXY").style.display="")}}function AddCondition(e){divMsg.innerHTML="",AddTopic("0",e)}function AddTopic(e,t){var i,n,d,o=null;1==t?(o=topicX,diffArray=topicY,i=ddlListX):(o=topicY,diffArray=topicX,i=ddlListY,document.getElementById("divTipY").style.display="none"),-1<o.indexOf(e)?divMsg.innerHTML="您已选择了该题目":-1<diffArray.indexOf(e)?divMsg.innerHTML="因变量不能与自变量相同":o==topicX&&2<=topicX.length?divMsg.innerHTML="自变量的个数最多为两个":o==topicY&&10<=topicY.length?divMsg.innerHTML="因变量的个数最多为10个":((n=document.createElement("div")).className="item",(d=i.cloneNode(!0)).value=e,d.onchange=ddlListChanged,d.prevValue=null,n.appendChild(d),(t=document.createElement("span")).className="icon icon-del",t.style.cursor="pointer",t.style.verticalAlign="middle",t.style.paddingLeft="1px",t.align="middle",t.onclick=function(){o.remove(d),i.parentNode.parentNode.removeChild(n),divMsg.innerHTML=""},n.appendChild(t),i.parentNode.parentNode.appendChild(n),o.push(d),(1<topicX.length||1<topicY.length)&&(document.getElementById("hrefSwapXY").style.display="none"))}function swapXY(){var e=topicX[0].value,t=topicY[0].value;0<e-1&&(topicX[0].value="-1",topicY[0].value=e,topicX[0].value=t),btnAnalyzeClick()}function getRCond(){for(var e="",t="",i=0,n=new Array,d=0;d<topicX.length;d++)"0"==(o=topicX[d].value)||n[o]||(0<i&&(e+=","),e+=o,n[o]="1",i++);for(i=0,d=0;d<topicY.length;d++){var o=topicY[d].value;"-1"==topicY[d].value||n[o]||(0<i&&(t+=","),t+=o,n[o]="1",i++)}return e+";"+t}function btnAnalyzeClick(){if(2==topicX.length)for(var e,t=0;t<topicX.length;t++)if(parseInt(topicX[t].value)<0)return e=topicX[t].options[topicX[t].selectedIndex].text,void(divMsg.innerHTML="很抱歉，"+e+"只能单独作为自变量，不能跟其他变量组合。");if(1==topicX.length&&"0"==topicX[0].value)divMsg.innerHTML="请选择自变量";else{var i,n;if(1!=topicY.length||"0"!=topicY[0].value)return 0<topicX.length&&0<topicY.length?(i=getRCond(),-1<location.href.indexOf("viewregnew2.aspx")?regloc="viewregnew2.aspx":-1<location.href.indexOf("viewregnew.aspx")&&(regloc="viewregnew.aspx"),i="/wjx/activitystat/"+regloc+"?activity="+activityId+"&rrc="+encodeURIComponent(i),n="",i+=n=ddlReportSource&&ddlReportSource.value?"&sid="+ddlReportSource.value:n,"1"==satParam&&(i+="&sat="+satParam),window.quesId&&(i+="&quesid="+window.quesId,window.userId)&&0<window.userId&&(i+="&uid="+window.userId),window.location=i+hideU,!0):!(divMsg.innerHTML="自变量跟因变量不能为空");divMsg.innerHTML="请选择因变量"}}function addSource(){changeTab("liQuery"),document.getElementById("spanCrossTip").style.display=""}function btnCompareClick(){var e=document.getElementById("divMsgCompare"),t=$("#ddlListCompare option:selected").attr("count"),i=$("#ddlListCompare").next().next().find("select").val();if(i&&0<i?t=1:0<(i=$("#ddlListCompare").next().next().find("span.wjxui-form-checkbox").find(":checkbox:checked").length)&&(t=i),15<t)e.innerHTML="该题选项个数大于15个，请使用交叉分析选择部分题目进行分析";else if(101<$("#ddlListY").find("option").length)e.innerHTML="当前问卷对比分析的题目数过多，请使用交叉分析选择部分题目进行分析";else{if("0"!=$("#ddlListCompare").val())return 0<$("#ddlListCompare").val()?(i=getCompareQueryCond(),-1<location.href.indexOf("viewregnew3.aspx")&&(regloc="viewregnew3.aspx"),t="/wjx/activitystat/viewregnew3.aspx?activity="+activityId+"&cmc="+encodeURIComponent(i),"1"==satParam&&(t+="&sat="+satParam),window.quesId&&(t+="&quesid="+window.quesId,window.userId)&&0<window.userId&&(t+="&uid="+window.userId),window.location=t+hideU,!0):void 0;e.innerHTML="请选择您要对比的变量"}}function saveCompare(){var e,t;"0"==$("#ddlListCompare").val()?divMsgCompare.innerHTML="请选择您要对比的变量":0<$("#ddlListCompare").val()&&(t=getCompareQueryCond(),e=$("#ddlListCompare option:selected").text().replace("(","").replace(")",""),t="/wjx/activitystat/savereport.aspx?activity="+activityId+"&type=4&qCond="+t+"&name="+encodeURIComponent(e),"1"==satParam&&(t+="&sat=1"),PDF_launch(t,404,207))}ddlJiaoCha&&(ddlJiaoCha.onchange=function(){this.value&&(window.location=this.value),btnDelFenLei.style.display=this.value?"":"none"}),btnDelJiaoCha&&(btnDelJiaoCha.style.display=2==reportType&&reportid&&0<+reportid?"":"none",btnDelJiaoCha.onclick=function(){var o="/wjx/report/deletereport.aspx?activity="+activityId+"&reportid="+reportid;lconfirm("此操作无法恢复，确认删除吗？",function(){if(delInsightAction){for(var e=[],t=$(".dongchaDiv"),i=0;i<t.length;i++){var n=t[i],n=$(n).closest(".title-item").find("table").attr("qi"),d=n+"‡"+window.qCond+"‡"+window.eCond;hashTagObj[d]&&e.push(n)}e.length&&delInsightAction(e.join(","),null)}PDF_launch(o,400,100)})}),btnDelCompare&&(btnDelCompare.style.display=4==reportType&&reportid&&0<+reportid?"":"none",btnDelCompare.onclick=function(){var e="/wjx/report/deletereport.aspx?activity="+activityId+"&reportid="+reportid;lconfirm("此操作无法恢复，确认删除吗？",function(){PDF_launch(e,400,100)})}),Init(),"time"==reg&&(changeTab("liJiaoCha"),topicX[0].value="-4"),ddlReportSource&&(sid&&(ddlReportSource.value=sid),ddlReportSource.onchange=function(){"-1"==this.value&&addSource()});